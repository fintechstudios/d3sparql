!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3"),require("topojson-client")):"function"==typeof define&&define.amd?define(["d3","topojson-client"],e):(t=t||self).d3sparql=e(t.d3,t.topojson)}(this,(function(t,e){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const r={version:"d3sparql.js version 2020-04-25",debug:!1};function a(t){if(r.debug)switch(typeof t){case"object":console.debug(JSON.stringify(t));break;default:console.debug(t)}}return r.fetch=async(t,e={})=>{a(t);const r=await fetch(t,{...e,headers:{...e.headers,Accept:"application/sparql-results+json"}});if(!r.ok)throw new Error(await r.text());return r.json()},r.query=function(t,e,a="GET"){const n=new URL(t);if("GET"===a)return n.search="query="+encodeURIComponent(e),r.fetch(n.href);if("POST"===a){const t=new FormData;t.append("query",e);const a=new URLSearchParams([...t.entries()]);return r.fetch(n.href,{body:a,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}throw new TypeError("unsupported query type: "+a)},r.graph=function(t,e={}){let r=t.head.lets||[],n=t.results.bindings;const l=e.key1||r[0]||"key1",i=e.key2||r[1]||"key2",o=e.label1||r[2]||!1,s=e.label2||r[3]||!1,c=e.value1||r[4]||!1,d=e.value2||r[5]||!1;let u={nodes:[],links:[]},h=new Map,p=0;for(let t=0;t<n.length;t++){let e=n[t],r=e[l].value,a=e[i].value,f=o?e[o].value:r,g=s?e[s].value:a,m=!!c&&e[c].value,y=!!d&&e[d].value;h.has(r)||(u.nodes.push({key:r,label:f,value:m}),h.set(r,p),p++),h.has(a)||(u.nodes.push({key:a,label:g,value:y}),h.set(a,p),p++),u.links.push({source:h.get(r),target:h.get(a)})}return a(u),u},r.tree=function(e,r={}){let n=e.head.lets||[],l=e.results.bindings;const i=r.root||n[0],o=r.parent||n[1],s=r.child||n[2],c=r.value||n[3]||"value";let d=new Map,u=new Map,h=l[0][i].value,p=!0,f=p;for(let t=0;t<l.length;t++){const e=l[t];if(p=e[o].value,f=e[s].value,p!==f){let t;d.has(p)?(t=d.get(p),t.push(f)):t=[f],d.set(p,t),e[c]&&u.set(f,e[c].value)}}let g=function e(r){let a=d.get(r);if(a){let n=a.map(t=>e(t)),l=t.sum(n,t=>t.value);return{name:r,children:n,value:t.sum([l,u.get(r)])}}return{name:r,value:u.get(r)||1}}(h);return a(g),g},r.htmltable=function(t,e={}){let n=t.head.lets||[],l=t.results.bindings;const i=e.columns||n,o=e.headers||i,s=e.selector||null,c=void 0!==e.limit?e.limit:l.length,d=void 0!==e.offset?e.offset:0;l=l.slice(d,d+c);let u=r.select(s,"htmltable").append("table").attr("class","table table-bordered");a("Table"),a(u);let h=u.append("thead"),p=u.append("tbody");h.append("tr").selectAll("th").data(o).enter().append("th").text(t=>t);let f=p.selectAll("tr").data(l).enter().append("tr").selectAll("td").data(t=>i.map(e=>t[e]?t[e].value:"")).enter().append("td").text(t=>t);a("Table cells"),a(f),u.style({margin:"10px"}),u.selectAll("th").style({background:"#eeeeee","text-transform":"capitalize"})},r.htmlhash=function(t,e){e=e||{};let a=t.head.lets||[],n=t.results.bindings[0],l={selector:e.selector||null},i=r.select(l.selector,"htmlhash").append("table").attr("class","table table-bordered"),o=i.append("tbody").selectAll("tr").data((function(){return a.map((function(t){return{head:t,data:n[t]?n[t].value:""}}))})).enter().append("tr");o.append("th").text((function(t){return t.head})),o.append("td").text((function(t){return t.data})),i.style({margin:"10px"}),i.selectAll("th").style({background:"#eeeeee","text-transform":"capitalize"})},r.barchart=function(e,a){a=a||{};let n=e.head.lets||[],l=e.results.bindings,i={label_x:a.label_x||n[0],label_y:a.label_y||n[1],let_x:a.let_x||n[0],let_y:a.let_y||n[1],width:a.width||750,height:a.height||300,margin:a.margin||80,selector:a.selector||null},o=t.scale.ordinal().rangeRoundBands([0,i.width-i.margin],.1),s=t.scale.linear().range([i.height-i.margin,0]),c=t.svg.axis().scale(o).orient("bottom"),d=t.svg.axis().scale(s).orient("left");o.domain(l.map((function(t){return t[i.let_x].value}))),s.domain(t.extent(l,(function(t){return parseInt(t[i.let_y].value)})));let u=r.select(i.selector,"barchart").append("svg").attr("width",i.width).attr("height",i.height),h=u.append("g").attr("class","axis x").attr("transform","translate("+i.margin+","+(i.height-i.margin)+")").call(c),p=u.append("g").attr("class","axis y").attr("transform","translate("+i.margin+",0)").call(d),f=u.selectAll(".bar").data(l).enter().append("rect").attr("transform","translate("+i.margin+",0)").attr("class","bar").attr("x",(function(t){return o(t[i.let_x].value)})).attr("width",o.rangeBand()).attr("y",(function(t){return s(t[i.let_y].value)})).attr("height",(function(t){return i.height-s(parseInt(t[i.let_y].value))-i.margin}));h.selectAll("text").attr("dy",".35em").attr("x",10).attr("y",0).attr("transform","rotate(90)").style("text-anchor","start"),h.append("text").attr("class","label").text(i.label_x).style("text-anchor","middle").attr("transform","translate("+(i.width-i.margin)/2+","+(i.margin-5)+")"),p.append("text").attr("class","label").text(i.label_y).style("text-anchor","middle").attr("transform","rotate(-90)").attr("x",0-i.height/2).attr("y",0-(i.margin-20)),f.attr({fill:"steelblue"}),u.selectAll(".axis").attr({stroke:"black",fill:"none","shape-rendering":"crispEdges"}),u.selectAll("text").attr({stroke:"none",fill:"black","font-size":"8pt","font-family":"sans-serif"})},r.piechart=function(e,a={}){let n=e.head.lets||[],l=e.results.bindings,i={label:a.label||n[0],size:a.size||n[1],width:a.width||700,height:a.height||700,margin:a.margin||10,hole:a.hole||100,selector:a.selector||null},o=Math.min(i.width,i.height)/2-i.margin,s=Math.max(Math.min(o-50,i.hole),0),c=t.scale.category20(),d=t.svg.arc().outerRadius(o).innerRadius(s),u=t.layout.pie().value((function(t){return t[i.size].value})),h=r.select(i.selector,"piechart").append("svg").attr("width",i.width).attr("height",i.height).append("g").attr("transform","translate("+i.width/2+","+i.height/2+")"),p=h.selectAll(".arc").data(u(l)).enter().append("g").attr("class","arc"),f=p.append("path").attr("d",d).attr("fill",(function(t,e){return c(e)}));p.append("text").attr("class","label").attr("transform",(function(t){return"translate("+d.centroid(t)+")"})).attr("dy",".35em").attr("text-anchor","middle").text((function(t){return t.data[i.label].value}));f.attr({stroke:"#ffffff"}),h.selectAll("text").attr({stroke:"none",fill:"black","font-size":"20px","font-family":"sans-serif"})},r.scatterplot=function(e,a={}){let n=e.head.lets||[],l=e.results.bindings,i={label_x:a.label_x||n[0]||"x",label_y:a.label_y||n[1]||"y",label_r:a.label_r||n[2]||"r",let_x:a.let_x||n[0],let_y:a.let_y||n[1],let_r:a.let_r||n[2]||5,min_r:a.min_r||1,max_r:a.max_r||20,width:a.width||850,height:a.height||300,margin_x:a.margin_x||80,margin_y:a.margin_y||40,selector:a.selector||null},o=t.extent(l,(function(t){return parseInt(t[i.let_x].value)})),s=t.extent(l,(function(t){return parseInt(t[i.let_y].value)})),c=t.extent(l,(function(t){return parseInt(t[i.let_r]?t[i.let_r].value:i.let_r)})),d=t.scale.linear().range([i.margin_x,i.width-i.margin_x]).domain(o),u=t.scale.linear().range([i.height-i.margin_y,i.margin_y]).domain(s),h=t.scale.linear().range([i.min_r,i.max_r]).domain(c),p=t.svg.axis().scale(d),f=t.svg.axis().scale(u).orient("left"),g=r.select(i.selector,"scatterplot").append("svg").attr("width",i.width).attr("height",i.height),m=g.selectAll("circle").data(l).enter().append("circle").attr("class","node").attr("cx",(function(t){return d(t[i.let_x].value)})).attr("cy",(function(t){return u(t[i.let_y].value)})).attr("r",(function(t){return h(t[i.let_r]?t[i.let_r].value:i.let_r)})).attr("opacity",.5).append("title").text((function(t){return t[i.label_r]?t[i.label_r].value:i.label_r})),y=g.append("g").attr("class","x axis").attr("transform","translate(0,"+(i.height-i.margin_y)+")").call(p),x=g.append("g").attr("class","y axis").attr("transform","translate("+i.margin_x+",0)").call(f);y.append("text").attr("class","label").text(i.label_x).style("text-anchor","middle").attr("transform","translate("+(i.width-i.margin_x)/2+","+(i.margin_y-5)+")"),x.append("text").attr("class","label").text(i.label_y).style("text-anchor","middle").attr("transform","rotate(-90)").attr("x",0-i.height/2).attr("y",0-(i.margin_x-20)),y.attr({stroke:"black",fill:"none"}),x.attr({stroke:"black",fill:"none"}),m.attr({stroke:"gray","stroke-width":"1px",fill:"lightblue",opacity:.5}),g.selectAll("text").attr({stroke:"none",fill:"black","font-size":"8pt","font-family":"sans-serif"})},r.forcegraph=function(e,a={}){let n=e.head&&e.results?r.graph(e,a):e,l=t.scale.linear().domain(t.extent(n.nodes,t=>parseFloat(t.value))).range([1,20]);const i=a.radius||(t=>t.value?l(t.value):1+t.label.length),o=a.charge||-500,s=a.distance||50,c=a.width||1e3,d=a.height||750,u=a.label||!1,h=a.selector||null;let p=r.select(h,"forcegraph").append("svg").attr("width",c).attr("height",d),f=p.selectAll(".link").data(n.links).enter().append("line").attr("class","link"),g=p.selectAll(".node").data(n.nodes).enter().append("g"),m=g.append("circle").attr("class","node").attr("r",i),y=g.append("text").text((function(t){return t[u||"label"]})).attr("class","node"),x=t.layout.force().charge(o).linkDistance(s).size([c,d]).nodes(n.nodes).links(n.links).start();x.on("tick",(function(){f.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),y.attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})),m.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y}))})),g.call(x.drag),f.attr({stroke:"#999999"}),m.attr({stroke:"black","stroke-width":"1px",fill:"lightblue",opacity:1}),y.attr({"font-size":"8px","font-family":"sans-serif"})},r.sankey=function(e,a){a=a||{};let n=e.head&&e.results?r.graph(e,a):e,l={width:a.width||750,height:a.height||1200,margin:a.margin||10,selector:a.selector||null},i=n.nodes,o=n.links;for(let t=0;t<o.length;t++)o[t].value=2;let s=t.sankey().size([l.width,l.height]).nodeWidth(15).nodePadding(10).nodes(i).links(o).layout(32),c=s.link(),d=t.scale.category20(),u=r.select(l.selector,"sankey").append("svg").attr("width",l.width+2*l.margin).attr("height",l.height+2*l.margin).append("g").attr("transform","translate("+l.margin+","+l.margin+")"),h=u.selectAll(".link").data(o).enter().append("path").attr("class","link").attr("d",c).attr("stroke-width",(function(t){return Math.max(1,t.dy)})).sort((function(t,e){return e.dy-t.dy})),p=u.selectAll(".node").data(i).enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).call(t.behavior.drag().origin((function(t){return t})).on("dragstart",(function(){this.parentNode.appendChild(this)})).on("drag",(function(e){t.select(this).attr("transform","translate("+e.x+","+(e.y=Math.max(0,Math.min(l.height-e.dy,t.event.y)))+")"),s.relayout(),h.attr("d",c)})));p.append("rect").attr("width",(function(t){return t.dx})).attr("height",(function(t){return t.dy})).attr("fill",(function(t){return d(t.label)})).attr("opacity",.5),p.append("text").attr("x",-6).attr("y",(function(t){return t.dy/2})).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text((function(t){return t.label})).filter((function(t){return t.x<l.width/2})).attr("x",6+s.nodeWidth()).attr("text-anchor","start"),h.attr({fill:"none",stroke:"grey",opacity:.5})},r.roundtree=function(e,a){a=a||{};let n=e.head&&e.results?r.tree(e,a):e,l={diameter:a.diameter||800,angle:a.angle||360,depth:a.depth||200,radius:a.radius||5,selector:a.selector||null},i=t.layout.tree().size([l.angle,l.depth]).separation((function(t,e){return(t.parent===e.parent?1:2)/t.depth})),o=i.nodes(n),s=i.links(o),c=t.svg.diagonal.radial().projection((function(t){return[t.y,t.x/180*Math.PI]})),d=r.select(l.selector,"roundtree").append("svg").attr("width",l.diameter).attr("height",l.diameter).append("g").attr("transform","translate("+l.diameter/2+","+l.diameter/2+")"),u=d.selectAll(".link").data(s).enter().append("path").attr("class","link").attr("d",c),h=d.selectAll(".node").data(o).enter().append("g").attr("class","node").attr("transform",(function(t){return"rotate("+(t.x-90)+") translate("+t.y+")"})),p=h.append("circle").attr("r",l.radius),f=h.append("text").attr("dy",".35em").attr("text-anchor",(function(t){return t.x<180?"start":"end"})).attr("transform",(function(t){return t.x<180?"translate(8)":"rotate(180) translate(-8)"})).text((function(t){return t.name}));u.attr({fill:"none",stroke:"#cccccc","stroke-width":"1.5px"}),p.attr({fill:"#ffffff",stroke:"steelblue","stroke-width":"1.5px",opacity:1}),f.attr({"font-size":"10px","font-family":"sans-serif"})},r.dendrogram=function(e,a){a=a||{};let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||800,height:a.height||2e3,margin:a.margin||350,radius:a.radius||5,selector:a.selector||null},i=t.layout.cluster().size([l.height,l.width-l.margin]),o=t.svg.diagonal().projection((function(t){return[t.y,t.x]})),s=r.select(l.selector,"dendrogram").append("svg").attr("width",l.width).attr("height",l.height).append("g").attr("transform","translate(40,0)"),c=i.nodes(n),d=i.links(c),u=s.selectAll(".link").data(d).enter().append("path").attr("class","link").attr("d",o),h=s.selectAll(".node").data(c).enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+t.y+","+t.x+")"})),p=h.append("circle").attr("r",l.radius),f=h.append("text").attr("dx",(function(t){return t.parent&&t.children?-8:8})).attr("dy",5).style("text-anchor",(function(t){return t.parent&&t.children?"end":"start"})).text((function(t){return t.name}));u.attr({fill:"none",stroke:"#cccccc","stroke-width":"1.5px"}),p.attr({fill:"#ffffff",stroke:"steelblue","stroke-width":"1.5px",opacity:1}),f.attr({"font-size":"10px","font-family":"sans-serif"})},r.sunburst=function(e,a={}){let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||1e3,height:a.height||900,margin:a.margin||150,selector:a.selector||null},i=Math.min(l.width,l.height)/2-l.margin,o=t.scale.linear().range([0,2*Math.PI]),s=t.scale.sqrt().range([0,i]),c=t.scale.category20(),d=r.select(l.selector,"sunburst").append("svg").attr("width",l.width).attr("height",l.height).append("g").attr("transform","translate("+l.width/2+","+l.height/2+")"),u=t.svg.arc().startAngle((function(t){return Math.max(0,Math.min(2*Math.PI,o(t.x)))})).endAngle((function(t){return Math.max(0,Math.min(2*Math.PI,o(t.x+t.dx)))})).innerRadius((function(t){return Math.max(0,s(t.y))})).outerRadius((function(t){return Math.max(0,s(t.y+t.dy))})),h=t.layout.partition().value((function(t){return t.value})).nodes(n),p=d.selectAll("path").data(h).enter().append("path").attr("d",u).attr("class","arc").style("fill",(function(t){return c((t.children?t:t.parent).name)})).on("click",g),f=d.selectAll("text").data(h).enter().append("text").attr("transform",(function(t){return"rotate("+(180*o(t.x+t.dx/2)/Math.PI-90)+") translate("+s(t.y)+")"})).attr("dx",".5em").attr("dy",".35em").text((function(t){return t.name})).on("click",g);function g(e){p.transition().duration(750).attrTween("d",function(e){let r=t.interpolate(o.domain(),[e.x,e.x+e.dx]),a=t.interpolate(s.domain(),[e.y,m(e)]),n=t.interpolate(s.range(),[e.y?20:0,i]);return function(t){return function(e){return o.domain(r(e)),s.domain(a(e)).range(n(e)),u(t)}}}(e)),f.style("visibility",(function(r){return y(e,r)?null:t.select(this).style("visibility")})).transition().duration(750).attrTween("transform",(function(t){return function(){return"rotate("+(180*o(t.x+t.dx/2)/Math.PI-90)+") translate("+s(t.y)+")"}})).each("end",(function(r){t.select(this).style("visibility",y(e,r)?null:"hidden")}))}function m(t){return t.children?Math.max.apply(Math,t.children.map(m)):t.y+t.dy}function y(t,e){return t===e||!!t.children&&t.children.some((function(t){return y(t,e)}))}p.attr({stroke:"#ffffff","fill-rule":"evenodd"}),f.attr({"font-size":"10px","font-family":"sans-serif"})},r.circlepack=function(e,a){a=a||{};let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||800,height:a.height||800,diameter:a.diameter||700,selector:a.selector||null},i=l.width,o=l.height,s=l.diameter,c=t.scale.linear().range([0,s]),d=t.scale.linear().range([0,s]),u=t.layout.pack().size([s,s]).value((function(t){return t.value})),h=n,p=u.nodes(n),f=r.select(l.selector,"circlepack").append("svg").attr("width",i).attr("height",o).append("g").attr("transform","translate("+(i-s)/2+","+(o-s)/2+")");function g(e,r){let a=s/e.r/2;c.domain([e.x-e.r,e.x+e.r]),d.domain([e.y-e.r,e.y+e.r]);let n=f.transition().duration(t.event.altKey?2e3:500);n.selectAll("circle").attr("cx",(function(t){return c(t.x)})).attr("cy",(function(t){return d(t.y)})).attr("r",(function(t){return a*t.r})),n.selectAll("text").attr("x",(function(t){return c(t.x)})).attr("y",(function(t){return d(t.y)})).style("opacity",(function(t){return a*t.r>20?1:0})),t.event.stopPropagation()}f.selectAll("circle").data(p).enter().append("circle").attr("class",(function(t){return t.children?"parent":"child"})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r})).on("click",(function(t){return g(h===t?n:t)})),f.selectAll("text").data(p).enter().append("text").attr("class",(function(t){return t.children?"parent":"child"})).attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).style("opacity",(function(t){return t.r>20?1:0})).text((function(t){return t.name})).attr("text-anchor","start").transition().duration(1e3).attr("transform",(function(t){return"rotate(-30, "+t.x+", "+t.y+")"})),t.select(window).on("click",(function(){g(n)}))},r.treemap=function(e,a={}){let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||800,height:a.height||500,count:a.count||!1,color:a.color||t.scale.category20c(),margin:a.margin||{top:0,right:0,bottom:0,left:0},selector:a.selector||null},i=l.width-l.margin.left-l.margin.right,o=l.height-l.margin.top-l.margin.bottom,s=l.color;let c=t.layout.treemap().size([i,o]).sticky(!0).value(l.count?function(t){return 1}:function(t){return t.value});r.select(l.selector,"treemap").style("position","relative").style("width",l.width+"px").style("height",l.height+"px").style("left",l.margin.left+"px").style("top",l.margin.top+"px").datum(n).selectAll(".node").data(c.nodes).enter().append("div").attr("class","node").call((function(){this.style("left",(function(t){return t.x+"px"})).style("top",(function(t){return t.y+"px"})).style("width",(function(t){return Math.max(0,t.dx-1)+"px"})).style("height",(function(t){return Math.max(0,t.dy-1)+"px"}))})).style("background",(function(t){return t.children?s(t.name):null})).text((function(t){return t.children?null:t.name})).style({"border-style":"solid","border-width":"1px","border-color":"white","font-size":"10px","font-family":"sans-serif","line-height":"12px",overflow:"hidden",position:"absolute","text-indent":"2px"})},r.treemapzoom=function(e,a){a=a||{};let n,l=e.head&&e.results?r.tree(e,a):e,i={width:a.width||800,height:a.height||500,margin:a.margin||{top:25,right:0,bottom:0,left:0},color:a.color||t.scale.category20(),format:a.format||t.format(",d"),selector:a.selector||null},o=i.width-i.margin.left-i.margin.right,s=i.height-i.margin.top-i.margin.bottom,c=i.color,d=i.format,u=t.scale.linear().domain([0,o]).range([0,o]),h=t.scale.linear().domain([0,s]).range([0,s]),p=t.layout.treemap().children((function(t,e){return e?null:t.children})).sort((function(t,e){return t.value-e.value})).ratio(s/o*.5*(1+Math.sqrt(5))).round(!1),f=r.select(i.selector,"treemapzoom").append("svg").attr("width",i.width).attr("height",i.height).style("margin-left",-i.margin.left+"px").style("margin.right",-i.margin.right+"px").append("g").attr("transform","translate("+i.margin.left+","+i.margin.top+")").style("shape-rendering","crispEdges"),g=f.append("g").attr("class","grandparent");function m(t){t.attr("x",(function(t){return u(t.x)+6})).attr("y",(function(t){return h(t.y)+6}))}function y(t){t.attr("x",(function(t){return u(t.x)})).attr("y",(function(t){return h(t.y)})).attr("width",(function(t){return u(t.x+t.dx)-u(t.x)})).attr("height",(function(t){return h(t.y+t.dy)-h(t.y)})).attr("fill",(function(t){return c(t.name)})),t.attr({stroke:"#ffffff","stroke-width":"1px",opacity:.8})}g.append("rect").attr("y",-i.margin.top).attr("width",o).attr("height",i.margin.top).attr("fill","#666666"),g.append("text").attr("x",6).attr("y",6-i.margin.top).attr("dy",".75em").attr("stroke","#ffffff").attr("fill","#ffffff"),function(t){t.x=t.y=0,t.dx=o,t.dy=s,t.depth=0}(l),function t(e){e.children&&(p.nodes({children:e.children}),e.children.forEach((function(r){r.x=e.x+r.x*e.dx,r.y=e.y+r.y*e.dy,r.dx*=e.dx,r.dy*=e.dy,r.parent=e,t(r)})))}(l),function t(e){g.datum(e.parent).on("click",l).select("text").text(function t(e){return e.parent?t(e.parent)+" / "+e.name:e.name}(e));let r=f.insert("g",".grandparent").datum(e).attr("class","depth"),a=r.selectAll("g").data(e.children).enter().append("g");function l(e){if(n||!e)return;n=!0;let a=t(e),l=r.transition().duration(750),i=a.transition().duration(750);u.domain([e.x,e.x+e.dx]),h.domain([e.y,e.y+e.dy]),f.style("shape-rendering",null),f.selectAll(".depth").sort((function(t,e){return t.depth-e.depth})),a.selectAll("text").style("fill-opacity",0),l.selectAll("text").call(m).style("fill-opacity",0),i.selectAll("text").call(m).style("fill-opacity",1),l.selectAll("rect").call(y),i.selectAll("rect").call(y),l.remove().each("end",(function(){f.style("shape-rendering","crispEdges"),n=!1}))}return a.filter((function(t){return t.children})).classed("children",!0).on("click",l),a.selectAll(".child").data((function(t){return t.children||[t]})).enter().append("rect").attr("class","child").call(y),a.append("rect").attr("class","parent").call(y).append("title").text((function(t){return d(t.value)})),a.append("text").attr("dy",".75em").text((function(t){return t.name})).call(m),a}(l)},r.coordmap=function(a,n={}){let l=a.head.lets||[],i=a.results.bindings,o={let_lat:n.let_lat||l[0]||"lat",let_lng:n.let_lng||l[1]||"lng",width:n.width||960,height:n.height||480,radius:n.radius||5,color:n.color||"#FF3333",topojson:n.topojson||"world-50m.json",selector:n.selector||null},s=t.geo.equirectangular().scale(153).translate([o.width/2,o.height/2]).precision(.1),c=t.geo.path().projection(s),d=t.geo.graticule(),u=r.select(o.selector,"coordmap").append("svg").attr("width",o.width).attr("height",o.height);u.append("path").datum(d.outline).attr("fill","#a4bac7").attr("d",c),u.append("path").datum(d).attr("fill","none").attr("stroke","#333333").attr("stroke-width",".5px").attr("stroke-opacity",".5").attr("d",c),t.json(o.topojson,(function(t,r){u.insert("path",".graticule").datum(e.feature(r,r.objects.land)).attr("fill","#d7c7ad").attr("stroke","#766951").attr("d",c),u.insert("path",".graticule").datum(e.mesh(r,r.objects.countries,(function(t,e){return t!==e}))).attr("class","boundary").attr("fill","none").attr("stroke","#a5967e").attr("stroke-width",".5px").attr("d",c),u.selectAll(".pin").data(i).enter().append("circle",".pin").attr("fill",o.color).attr("r",o.radius).attr("stroke","#455346").attr("transform",(function(t){return"translate("+s([t[o.let_lng].value,t[o.let_lat].value])+")"}))}))},r.namedmap=function(n,l){l=l||{};let i=n.head.lets||[],o=n.results.bindings,s={label:l.label||i[0]||"label",value:l.value||i[1]||"value",width:l.width||1e3,height:l.height||1e3,color_max:l.color_max||"red",color_min:l.color_min||"white",color_scale:l.color_scale||"log",topojson:l.topojson||"japan.topojson",mapname:l.mapname||"japan",keyname:l.keyname||"name_local",center_lat:l.center_lat||34,center_lng:l.center_lng||137,scale:l.scale||1e4,selector:l.selector||null},c=t.nest().key(t=>t[s.label].value).rollup(e=>t.sum(e,t=>parseInt(t[s.value].value))).map(o,t.map),d=t.extent(t.map(c).values());a(c);let u=r.select(s.selector,"namedmap").append("svg").attr("width",s.width).attr("height",s.height);t.json(s.topojson,(function(r){let a,n=e.object(r,r.objects[s.mapname]).geometries,l=t.geo.mercator().center([s.center_lng,s.center_lat]).translate([s.width/2,s.height/2]).scale(s.scale),i=t.geo.path().projection(l);switch(s.color_scale){case"log":a=t.scale.log();break;default:a=t.scale.linear()}let o=a.domain(d).range([s.color_min,s.color_max]);u.selectAll("path").data(n).enter().append("path").attr("d",i).attr("stroke","black").attr("stroke-width",.5).style("fill",(function(t,e){return o(c[t.properties[s.keyname]])})),u.selectAll(".place-label").data(n).enter().append("text").attr("font-size","8px").attr("class","place-label").attr("transform",(function(t){let e=t.properties.latitude,r=t.properties.longitude;return"translate("+l([r,e])+")"})).attr("dx","-1.5em").text(t=>t.properties[s.keyname])}))},r.select=function(e,r){return(e?t.select(e).html(""):t.select("body")).append("div").attr("class","d3sparql "+r)},r.toggle=function(){let e=t.select("#button"),r=t.select("#sparql");"none"===r.style("display")?(r.style("display","inline"),e.attr("class","icon-chevron-up")):(r.style("display","none"),e.attr("class","icon-chevron-down"))},r.frameheight=function(e){t.select(self.frameElement).style("height",e+"px")},r}));
//# sourceMappingURL=d3sparql.umd.js.map
