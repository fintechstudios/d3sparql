define(["d3","d3-sankey","topojson-client"],(function(t,e,a){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const r={version:"d3sparql.js version 2020-04-25",debug:!1};function n(...t){if(r.debug){const e=[];for(const a of t)switch(typeof a){case"object":e.push(JSON.stringify(a));break;default:e.push(a)}console.debug(...e)}}return r.fetch=async(t,e={})=>{n(t);const a=await fetch(t,{...e,headers:{...e.headers,Accept:"application/sparql-results+json"}});if(!a.ok)throw new Error(await a.text());return a.json()},r.query=function(t,e,a="GET"){const n=new URL(t);if("GET"===a)return n.search="query="+encodeURIComponent(e),r.fetch(n.href);if("POST"===a){const t=new FormData;t.append("query",e);const a=new URLSearchParams([...t.entries()]);return r.fetch(n.href,{body:a,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}throw new TypeError("unsupported query type: "+a)},r.graph=function(t,e={}){let a=t.head.lets||t.head.vars||[],r=t.results.bindings,l=e.key1||a[0]||"key1",i=e.key2||a[1]||"key2",s=e.label1||a[2]||!1,o=e.label2||a[3]||!1,c=e.value1||a[4]||!1,d=e.value2||a[5]||!1,u={nodes:[],links:[]},h=new Map,p=0;for(let t=0;t<r.length;t++){let e=r[t],a=e[l].value,n=e[i].value,f=s?e[s].value:a,g=o?e[o].value:n,m=!!c&&e[c].value,y=!!d&&e[d].value;h.has(a)||(u.nodes.push({key:a,label:f,value:m}),h.set(a,p),p++),h.has(n)||(u.nodes.push({key:n,label:g,value:y}),h.set(n,p),p++),u.links.push({source:h.get(a),target:h.get(n)})}return n(u),u},r.tree=function(e,a={}){let r=e.head.lets||e.head.vars||[],l=e.results.bindings,i=a.root||r[0],s=a.parent||r[1],o=a.child||r[2],c=a.value||r[3]||"value",d=new Map,u=new Map,h=l[0][i].value,p=!0,f=p;for(let t=0;t<l.length;t++){const e=l[t];if(p=e[s].value,f=e[o].value,p!==f){let t;d.has(p)?(t=d.get(p),t.push(f)):t=[f],d.set(p,t),e[c]&&u.set(f,e[c].value)}}let g=e=>{let a=d.get(e);if(!a)return{name:e,value:u.get(e)||1};let r=a.map(t=>g(t)),n=t.sum(r,t=>t.value);return{name:e,children:r,value:t.sum([n,u.get(e)])}},m=g(h);return n(m),m},r.htmltable=function(t,e={}){let a=t.head.lets||t.head.vars||[],l=t.results.bindings,i=e.columns||a,s=e.headers||i,o=e.selector||null,c=void 0!==e.limit?e.limit:l.length,d=void 0!==e.offset?e.offset:0;l=l.slice(d,d+c);let u=r.select(o,"htmltable").append("table").attr("class","table table-bordered");n("Table"),n(u);let h=u.append("thead"),p=u.append("tbody");h.append("tr").selectAll("th").data(s).enter().append("th").text(t=>t);let f=p.selectAll("tr").data(l).enter().append("tr").selectAll("td").data(t=>i.map(e=>t[e]?t[e].value:"")).enter().append("td").text(t=>t);n("Table cells"),n(f),u.style({margin:"10px"}),u.selectAll("th").style({background:"#eeeeee","text-transform":"capitalize"})},r.htmlhash=function(t,e={}){let a=t.head.lets||t.head.vars||[],n=t.results.bindings[0],l=e.selector||null,i=r.select(l,"htmlhash").append("table").attr("class","table table-bordered"),s=i.append("tbody").selectAll("tr").data(()=>a.map(t=>({head:t,data:n[t]?n[t].value:""}))).enter().append("tr");s.append("th").text(t=>t.head),s.append("td").text(t=>t.data),i.style({margin:"10px"}),i.selectAll("th").style({background:"#eeeeee","text-transform":"capitalize"})},r.barchart=function(e,a={}){let n=e.head.lets||e.head.vars||[],l=e.results.bindings,i=a.label_x||n[0],s=a.label_y||n[1],o=a.let_x||n[0],c=a.let_y||n[1],d=a.width||750,u=a.height||300,h=a.margin||80,p=a.selector||null,f=t.scale.ordinal().rangeRoundBands([0,d-h],.1),g=t.scale.linear().range([u-h,0]),m=t.svg.axis().scale(f).orient("bottom"),y=t.svg.axis().scale(g).orient("left");f.domain(l.map(t=>t[o].value)),g.domain(t.extent(l,t=>parseInt(t[c].value)));let x=r.select(p,"barchart").append("svg").attr("width",d).attr("height",u),b=x.append("g").attr("class","axis x").attr("transform","translate("+h+","+(u-h)+")").call(m),v=x.append("g").attr("class","axis y").attr("transform","translate("+h+",0)").call(y),w=x.selectAll(".bar").data(l).enter().append("rect").attr("transform","translate("+h+",0)").attr("class","bar").attr("x",t=>f(t[o].value)).attr("width",f.rangeBand()).attr("y",t=>g(t[c].value)).attr("height",t=>u-g(parseInt(t[c].value))-h);b.selectAll("text").attr("dy",".35em").attr("x",10).attr("y",0).attr("transform","rotate(90)").style("text-anchor","start"),b.append("text").attr("class","label").text(i).style("text-anchor","middle").attr("transform","translate("+(d-h)/2+","+(h-5)+")"),v.append("text").attr("class","label").text(s).style("text-anchor","middle").attr("transform","rotate(-90)").attr("x",0-u/2).attr("y",0-(h-20)),w.attr({fill:"steelblue"}),x.selectAll(".axis").attr({stroke:"black",fill:"none","shape-rendering":"crispEdges"}),x.selectAll("text").attr({stroke:"none",fill:"black","font-size":"8pt","font-family":"sans-serif"})},r.piechart=function(e,a={}){let n=e.head.lets||e.head.vars||[],l=e.results.bindings,i=a.label||n[0],s=a.size||n[1],o=a.width||700,c=a.height||700,d=a.margin||10,u=a.selector||null,h=a.hole||100,p=Math.min(o,c)/2-d,f=Math.max(Math.min(p-50,h),0),g=t.scale.category20(),m=t.svg.arc().outerRadius(p).innerRadius(f),y=t.layout.pie().value(t=>t[s].value),x=r.select(u,"piechart").append("svg").attr("width",o).attr("height",c).append("g").attr("transform","translate("+o/2+","+c/2+")"),b=x.selectAll(".arc").data(y(l)).enter().append("g").attr("class","arc"),v=b.append("path").attr("d",m).attr("fill",(t,e)=>g(e));b.append("text").attr("class","label").attr("transform",t=>`translate(${m.centroid(t)})`).attr("dy",".35em").attr("text-anchor","middle").text(t=>t.data[i].value);v.attr({stroke:"#ffffff"}),x.selectAll("text").attr({stroke:"none",fill:"black","font-size":"20px","font-family":"sans-serif"})},r.scatterplot=function(e,a={}){let n=e.head.lets||e.head.vars||[],l=e.results.bindings,i={label_x:a.label_x||n[0]||"x",label_y:a.label_y||n[1]||"y",label_r:a.label_r||n[2]||"r",let_x:a.let_x||n[0],let_y:a.let_y||n[1],let_r:a.let_r||n[2]||5,min_r:a.min_r||1,max_r:a.max_r||20,width:a.width||850,height:a.height||300,margin_x:a.margin_x||80,margin_y:a.margin_y||40,selector:a.selector||null},s=t.extent(l,(function(t){return parseInt(t[i.let_x].value)})),o=t.extent(l,(function(t){return parseInt(t[i.let_y].value)})),c=t.extent(l,(function(t){return parseInt(t[i.let_r]?t[i.let_r].value:i.let_r)})),d=t.scale.linear().range([i.margin_x,i.width-i.margin_x]).domain(s),u=t.scale.linear().range([i.height-i.margin_y,i.margin_y]).domain(o),h=t.scale.linear().range([i.min_r,i.max_r]).domain(c),p=t.svg.axis().scale(d),f=t.svg.axis().scale(u).orient("left"),g=r.select(i.selector,"scatterplot").append("svg").attr("width",i.width).attr("height",i.height),m=g.selectAll("circle").data(l).enter().append("circle").attr("class","node").attr("cx",(function(t){return d(t[i.let_x].value)})).attr("cy",(function(t){return u(t[i.let_y].value)})).attr("r",(function(t){return h(t[i.let_r]?t[i.let_r].value:i.let_r)})).attr("opacity",.5).append("title").text((function(t){return t[i.label_r]?t[i.label_r].value:i.label_r})),y=g.append("g").attr("class","x axis").attr("transform","translate(0,"+(i.height-i.margin_y)+")").call(p),x=g.append("g").attr("class","y axis").attr("transform","translate("+i.margin_x+",0)").call(f);y.append("text").attr("class","label").text(i.label_x).style("text-anchor","middle").attr("transform","translate("+(i.width-i.margin_x)/2+","+(i.margin_y-5)+")"),x.append("text").attr("class","label").text(i.label_y).style("text-anchor","middle").attr("transform","rotate(-90)").attr("x",0-i.height/2).attr("y",0-(i.margin_x-20)),y.attr({stroke:"black",fill:"none"}),x.attr({stroke:"black",fill:"none"}),m.attr({stroke:"gray","stroke-width":"1px",fill:"lightblue",opacity:.5}),g.selectAll("text").attr({stroke:"none",fill:"black","font-size":"8pt","font-family":"sans-serif"})},r.forcegraph=function(e,a={}){let n=e.head&&e.results?r.graph(e,a):e;const l=a.radius||(t=>t.value?h(t.value):1+t.label.length),i=a.charge||-500,s=a.distance||50,o=a.width||1e3,c=a.height||750,d=a.label||!1,u=a.selector||null;let h=t.scale.linear().domain(t.extent(n.nodes,t=>parseFloat(t.value))).range([1,20]),p=r.select(u,"forcegraph").append("svg").attr("width",o).attr("height",c),f=p.selectAll(".link").data(n.links).enter().append("line").attr("class","link"),g=p.selectAll(".node").data(n.nodes).enter().append("g"),m=g.append("circle").attr("class","node").attr("r",l),y=g.append("text").text((function(t){return t[d||"label"]})).attr("class","node"),x=t.layout.force().charge(i).linkDistance(s).size([o,c]).nodes(n.nodes).links(n.links).start();x.on("tick",(function(){f.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),y.attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})),m.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y}))})),g.call(x.drag),f.attr({stroke:"#999999"}),m.attr({stroke:"black","stroke-width":"1px",fill:"lightblue",opacity:1}),y.attr({"font-size":"8px","font-family":"sans-serif"})},r.sankey=function(e,a){a=a||{};let n=e.head&&e.results?r.graph(e,a):e,l={width:a.width||750,height:a.height||1200,margin:a.margin||10,selector:a.selector||null},i=n.nodes,s=n.links;for(let t=0;t<s.length;t++)s[t].value=2;let o=t.sankey().size([l.width,l.height]).nodeWidth(15).nodePadding(10).nodes(i).links(s).layout(32),c=o.link(),d=t.scale.category20(),u=r.select(l.selector,"sankey").append("svg").attr("width",l.width+2*l.margin).attr("height",l.height+2*l.margin).append("g").attr("transform","translate("+l.margin+","+l.margin+")"),h=u.selectAll(".link").data(s).enter().append("path").attr("class","link").attr("d",c).attr("stroke-width",(function(t){return Math.max(1,t.dy)})).sort((function(t,e){return e.dy-t.dy})),p=u.selectAll(".node").data(i).enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).call(t.behavior.drag().origin((function(t){return t})).on("dragstart",(function(){this.parentNode.appendChild(this)})).on("drag",(function(e){t.select(this).attr("transform","translate("+e.x+","+(e.y=Math.max(0,Math.min(l.height-e.dy,t.event.y)))+")"),o.relayout(),h.attr("d",c)})));p.append("rect").attr("width",(function(t){return t.dx})).attr("height",(function(t){return t.dy})).attr("fill",(function(t){return d(t.label)})).attr("opacity",.5),p.append("text").attr("x",-6).attr("y",(function(t){return t.dy/2})).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text((function(t){return t.label})).filter((function(t){return t.x<l.width/2})).attr("x",6+o.nodeWidth()).attr("text-anchor","start"),h.attr({fill:"none",stroke:"grey",opacity:.5})},r.roundtree=function(e,a){a=a||{};let n=e.head&&e.results?r.tree(e,a):e,l={diameter:a.diameter||800,angle:a.angle||360,depth:a.depth||200,radius:a.radius||5,selector:a.selector||null},i=t.layout.tree().size([l.angle,l.depth]).separation((function(t,e){return(t.parent===e.parent?1:2)/t.depth})),s=i.nodes(n),o=i.links(s),c=t.svg.diagonal.radial().projection((function(t){return[t.y,t.x/180*Math.PI]})),d=r.select(l.selector,"roundtree").append("svg").attr("width",l.diameter).attr("height",l.diameter).append("g").attr("transform","translate("+l.diameter/2+","+l.diameter/2+")"),u=d.selectAll(".link").data(o).enter().append("path").attr("class","link").attr("d",c),h=d.selectAll(".node").data(s).enter().append("g").attr("class","node").attr("transform",(function(t){return"rotate("+(t.x-90)+") translate("+t.y+")"})),p=h.append("circle").attr("r",l.radius),f=h.append("text").attr("dy",".35em").attr("text-anchor",(function(t){return t.x<180?"start":"end"})).attr("transform",(function(t){return t.x<180?"translate(8)":"rotate(180) translate(-8)"})).text((function(t){return t.name}));u.attr({fill:"none",stroke:"#cccccc","stroke-width":"1.5px"}),p.attr({fill:"#ffffff",stroke:"steelblue","stroke-width":"1.5px",opacity:1}),f.attr({"font-size":"10px","font-family":"sans-serif"})},r.dendrogram=function(e,a={}){let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||800,height:a.height||2e3,margin:a.margin||350,radius:a.radius||5,selector:a.selector||null},i=t.layout.cluster().size([l.height,l.width-l.margin]),s=t.svg.diagonal().projection((function(t){return[t.y,t.x]})),o=r.select(l.selector,"dendrogram").append("svg").attr("width",l.width).attr("height",l.height).append("g").attr("transform","translate(40,0)"),c=i.nodes(n),d=i.links(c),u=o.selectAll(".link").data(d).enter().append("path").attr("class","link").attr("d",s),h=o.selectAll(".node").data(c).enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+t.y+","+t.x+")"})),p=h.append("circle").attr("r",l.radius),f=h.append("text").attr("dx",(function(t){return t.parent&&t.children?-8:8})).attr("dy",5).style("text-anchor",(function(t){return t.parent&&t.children?"end":"start"})).text((function(t){return t.name}));u.attr({fill:"none",stroke:"#cccccc","stroke-width":"1.5px"}),p.attr({fill:"#ffffff",stroke:"steelblue","stroke-width":"1.5px",opacity:1}),f.attr({"font-size":"10px","font-family":"sans-serif"})},r.sunburst=function(e,a={}){let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||1e3,height:a.height||900,margin:a.margin||150,selector:a.selector||null},i=Math.min(l.width,l.height)/2-l.margin,s=t.scale.linear().range([0,2*Math.PI]),o=t.scale.sqrt().range([0,i]),c=t.scale.category20(),d=r.select(l.selector,"sunburst").append("svg").attr("width",l.width).attr("height",l.height).append("g").attr("transform","translate("+l.width/2+","+l.height/2+")"),u=t.svg.arc().startAngle((function(t){return Math.max(0,Math.min(2*Math.PI,s(t.x)))})).endAngle((function(t){return Math.max(0,Math.min(2*Math.PI,s(t.x+t.dx)))})).innerRadius((function(t){return Math.max(0,o(t.y))})).outerRadius((function(t){return Math.max(0,o(t.y+t.dy))})),h=t.layout.partition().value((function(t){return t.value})).nodes(n),p=d.selectAll("path").data(h).enter().append("path").attr("d",u).attr("class","arc").style("fill",(function(t){return c((t.children?t:t.parent).name)})).on("click",g),f=d.selectAll("text").data(h).enter().append("text").attr("transform",(function(t){return"rotate("+(180*s(t.x+t.dx/2)/Math.PI-90)+") translate("+o(t.y)+")"})).attr("dx",".5em").attr("dy",".35em").text((function(t){return t.name})).on("click",g);function g(e){p.transition().duration(750).attrTween("d",function(e){let a=t.interpolate(s.domain(),[e.x,e.x+e.dx]),r=t.interpolate(o.domain(),[e.y,m(e)]),n=t.interpolate(o.range(),[e.y?20:0,i]);return t=>e=>(s.domain(a(e)),o.domain(r(e)).range(n(e)),u(t))}(e)),f.style("visibility",(function(a){return y(e,a)?null:t.select(this).style("visibility")})).transition().duration(750).attrTween("transform",(function(t){return function(){return"rotate("+(180*s(t.x+t.dx/2)/Math.PI-90)+") translate("+o(t.y)+")"}})).each("end",(function(a){t.select(this).style("visibility",y(e,a)?null:"hidden")}))}function m(t){return t.children?Math.max.apply(Math,t.children.map(m)):t.y+t.dy}function y(t,e){return t===e||!!t.children&&t.children.some(t=>y(t,e))}p.attr({stroke:"#ffffff","fill-rule":"evenodd"}),f.attr({"font-size":"10px","font-family":"sans-serif"})},r.circlepack=function(e,a={}){let n=e.head&&e.results?r.tree(e,a):e,l={width:a.width||800,height:a.height||800,diameter:a.diameter||700,selector:a.selector||null},i=l.width,s=l.height,o=l.diameter,c=t.scale.linear().range([0,o]),d=t.scale.linear().range([0,o]),u=t.layout.pack().size([o,o]).value((function(t){return t.value})),h=n,p=u.nodes(n),f=r.select(l.selector,"circlepack").append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+(i-o)/2+","+(s-o)/2+")");function g(e,a){let r=o/e.r/2;c.domain([e.x-e.r,e.x+e.r]),d.domain([e.y-e.r,e.y+e.r]);let n=f.transition().duration(t.event.altKey?2e3:500);n.selectAll("circle").attr("cx",(function(t){return c(t.x)})).attr("cy",(function(t){return d(t.y)})).attr("r",(function(t){return r*t.r})),n.selectAll("text").attr("x",(function(t){return c(t.x)})).attr("y",(function(t){return d(t.y)})).style("opacity",(function(t){return r*t.r>20?1:0})),t.event.stopPropagation()}f.selectAll("circle").data(p).enter().append("circle").attr("class",(function(t){return t.children?"parent":"child"})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r})).on("click",(function(t){return g(h===t?n:t)})),f.selectAll("text").data(p).enter().append("text").attr("class",(function(t){return t.children?"parent":"child"})).attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).style("opacity",(function(t){return t.r>20?1:0})).text((function(t){return t.name})).attr("text-anchor","start").transition().duration(1e3).attr("transform",(function(t){return"rotate(-30, "+t.x+", "+t.y+")"})),t.select(window).on("click",(function(){g(n)}))},r.treemap=function(e,a={}){let n=e.head&&e.results?r.tree(e,a):e,l=a.width||800,i=a.height||500,s=a.count||!1,o=a.color||t.scale.category20c(),c=a.margin||{top:0,right:0,bottom:0,left:0},d=a.selector||null;l=l-c.left-c.right,i=i-c.top-c.bottom;let u=t.layout.treemap().size([l,i]).sticky(!0).value(s?t=>1:t=>t.value);r.select(d,"treemap").style("position","relative").style("width",l+"px").style("height",i+"px").style("left",c.left+"px").style("top",c.top+"px").datum(n).selectAll(".node").data(u.nodes).enter().append("div").attr("class","node").call((function(){this.style("left",(function(t){return t.x+"px"})).style("top",(function(t){return t.y+"px"})).style("width",(function(t){return Math.max(0,t.dx-1)+"px"})).style("height",(function(t){return Math.max(0,t.dy-1)+"px"}))})).style("background",t=>t.children?o(t.name):null).text(t=>t.children?null:t.name).style({"border-style":"solid","border-width":"1px","border-color":"white","font-size":"10px","font-family":"sans-serif","line-height":"12px",overflow:"hidden",position:"absolute","text-indent":"2px"})},r.treemapzoom=function(e,a={}){let n,l=e.head&&e.results?r.tree(e,a):e,i={width:a.width||800,height:a.height||500,margin:a.margin||{top:25,right:0,bottom:0,left:0},color:a.color||t.scale.category20(),format:a.format||t.format(",d"),selector:a.selector||null},s=i.width-i.margin.left-i.margin.right,o=i.height-i.margin.top-i.margin.bottom,c=i.color,d=i.format,u=t.scale.linear().domain([0,s]).range([0,s]),h=t.scale.linear().domain([0,o]).range([0,o]),p=t.layout.treemap().children((function(t,e){return e?null:t.children})).sort((function(t,e){return t.value-e.value})).ratio(o/s*.5*(1+Math.sqrt(5))).round(!1),f=r.select(i.selector,"treemapzoom").append("svg").attr("width",i.width).attr("height",i.height).style("margin-left",-i.margin.left+"px").style("margin.right",-i.margin.right+"px").append("g").attr("transform","translate("+i.margin.left+","+i.margin.top+")").style("shape-rendering","crispEdges"),g=f.append("g").attr("class","grandparent");g.append("rect").attr("y",-i.margin.top).attr("width",s).attr("height",i.margin.top).attr("fill","#666666"),g.append("text").attr("x",6).attr("y",6-i.margin.top).attr("dy",".75em").attr("stroke","#ffffff").attr("fill","#ffffff");let m=t=>{t.children&&(p.nodes({children:t.children}),t.children.forEach(e=>{e.x=t.x+e.x*t.dx,e.y=t.y+e.y*t.dy,e.dx*=t.dx,e.dy*=t.dy,e.parent=t,m(e)}))};function y(t){t.attr("x",(function(t){return u(t.x)+6})).attr("y",(function(t){return h(t.y)+6}))}function x(t){t.attr("x",(function(t){return u(t.x)})).attr("y",(function(t){return h(t.y)})).attr("width",(function(t){return u(t.x+t.dx)-u(t.x)})).attr("height",(function(t){return h(t.y+t.dy)-h(t.y)})).attr("fill",(function(t){return c(t.name)})),t.attr({stroke:"#ffffff","stroke-width":"1px",opacity:.8})}(t=>{t.x=t.y=0,t.dx=s,t.dy=o,t.depth=0})(l),m(l),function t(e){g.datum(e.parent).on("click",l).select("text").text(function t(e){return e.parent?t(e.parent)+" / "+e.name:e.name}(e));let a=f.insert("g",".grandparent").datum(e).attr("class","depth"),r=a.selectAll("g").data(e.children).enter().append("g");function l(e){if(n||!e)return;n=!0;let r=t(e),l=a.transition().duration(750),i=r.transition().duration(750);u.domain([e.x,e.x+e.dx]),h.domain([e.y,e.y+e.dy]),f.style("shape-rendering",null),f.selectAll(".depth").sort((function(t,e){return t.depth-e.depth})),r.selectAll("text").style("fill-opacity",0),l.selectAll("text").call(y).style("fill-opacity",0),i.selectAll("text").call(y).style("fill-opacity",1),l.selectAll("rect").call(x),i.selectAll("rect").call(x),l.remove().each("end",(function(){f.style("shape-rendering","crispEdges"),n=!1}))}return r.filter((function(t){return t.children})).classed("children",!0).on("click",l),r.selectAll(".child").data((function(t){return t.children||[t]})).enter().append("rect").attr("class","child").call(x),r.append("rect").attr("class","parent").call(x).append("title").text((function(t){return d(t.value)})),r.append("text").attr("dy",".75em").text((function(t){return t.name})).call(y),r}(l)},r.coordmap=function(e,n={}){let l=e.head.lets||e.head.vars||[],i=e.results.bindings,s={let_lat:n.let_lat||l[0]||"lat",let_lng:n.let_lng||l[1]||"lng",width:n.width||960,height:n.height||480,radius:n.radius||5,color:n.color||"#FF3333",topojson:n.topojson||"world-50m.json",selector:n.selector||null},o=t.geo.equirectangular().scale(153).translate([s.width/2,s.height/2]).precision(.1),c=t.geo.path().projection(o),d=t.geo.graticule(),u=r.select(s.selector,"coordmap").append("svg").attr("width",s.width).attr("height",s.height);u.append("path").datum(d.outline).attr("fill","#a4bac7").attr("d",c),u.append("path").datum(d).attr("fill","none").attr("stroke","#333333").attr("stroke-width",".5px").attr("stroke-opacity",".5").attr("d",c),t.json(s.topojson,(function(t,e){u.insert("path",".graticule").datum(a.feature(e,e.objects.land)).attr("fill","#d7c7ad").attr("stroke","#766951").attr("d",c),u.insert("path",".graticule").datum(a.mesh(e,e.objects.countries,(function(t,e){return t!==e}))).attr("class","boundary").attr("fill","none").attr("stroke","#a5967e").attr("stroke-width",".5px").attr("d",c),u.selectAll(".pin").data(i).enter().append("circle",".pin").attr("fill",s.color).attr("r",s.radius).attr("stroke","#455346").attr("transform",(function(t){return"translate("+o([t[s.let_lng].value,t[s.let_lat].value])+")"}))}))},r.namedmap=function(e,l={}){let i=e.head.lets||e.head.vars||[],s=e.results.bindings,o={label:l.label||i[0]||"label",value:l.value||i[1]||"value",width:l.width||1e3,height:l.height||1e3,color_max:l.color_max||"red",color_min:l.color_min||"white",color_scale:l.color_scale||"log",topojson:l.topojson||"japan.topojson",mapname:l.mapname||"japan",keyname:l.keyname||"name_local",center_lat:l.center_lat||34,center_lng:l.center_lng||137,scale:l.scale||1e4,selector:l.selector||null},c=t.nest().key(t=>t[o.label].value).rollup(e=>t.sum(e,t=>parseInt(t[o.value].value))).map(s,t.map),d=t.extent(t.map(c).values());n(c);let u=r.select(o.selector,"namedmap").append("svg").attr("width",o.width).attr("height",o.height);t.json(o.topojson,(function(e){let r,n=a.object(e,e.objects[o.mapname]).geometries,l=t.geo.mercator().center([o.center_lng,o.center_lat]).translate([o.width/2,o.height/2]).scale(o.scale),i=t.geo.path().projection(l);switch(o.color_scale){case"log":r=t.scale.log();break;default:r=t.scale.linear()}let s=r.domain(d).range([o.color_min,o.color_max]);u.selectAll("path").data(n).enter().append("path").attr("d",i).attr("stroke","black").attr("stroke-width",.5).style("fill",(function(t,e){return s(c[t.properties[o.keyname]])})),u.selectAll(".place-label").data(n).enter().append("text").attr("font-size","8px").attr("class","place-label").attr("transform",(function(t){let e=t.properties.latitude,a=t.properties.longitude;return"translate("+l([a,e])+")"})).attr("dx","-1.5em").text(t=>t.properties[o.keyname])}))},r.select=function(e,a){return(e?t.select(e).html(""):t.select("body")).append("div").attr("class","d3sparql "+a)},r.toggle=function(){let e=t.select("#button"),a=t.select("#sparql");"none"===a.style("display")?(a.style("display","inline"),e.attr("class","icon-chevron-up")):(a.style("display","none"),e.attr("class","icon-chevron-down"))},r.frameheight=function(e){t.select(self.frameElement).style("height",e+"px")},r}));
//# sourceMappingURL=d3sparql.amd.js.map
