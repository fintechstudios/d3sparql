define(["d3","d3-sankey","topojson-client"],(function(t,e,a){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const r={version:"d3sparql.js version 2020-04-25",debug:!1};function l(...t){if(r.debug){const e=[];for(const a of t)switch(typeof a){case"object":e.push(JSON.stringify(a));break;default:e.push(a)}console.debug(...e)}}return r.fetch=async(t,e={})=>{l(t,e);const a=await fetch(t,{...e,headers:{...e.headers,Accept:"application/sparql-results+json"}});if(!a.ok)throw new Error(await a.text());return a.json()},r.query=function(t,e,a="GET"){const l=new URL(t);if("GET"===a)return l.search="query="+encodeURIComponent(e),r.fetch(l.href);if("POST"===a){const t=new FormData;t.append("query",e);const a=new URLSearchParams([...t.entries()]);return r.fetch(l.href,{body:a,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}throw new TypeError("unsupported query type: "+a)},r.graph=function(t,e={}){let a=t.head.lets||t.head.vars||[],r=t.results.bindings,n=e.key1||a[0]||"key1",s=e.key2||a[1]||"key2",i=e.label1||a[2]||!1,o=e.label2||a[3]||!1,c=e.value1||a[4]||!1,d=e.value2||a[5]||!1,p={nodes:[],links:[]},h=new Map,u=0;for(let t=0;t<r.length;t++){let e=r[t],a=e[n].value,l=e[s].value,f=i?e[i].value:a,g=o?e[o].value:l,y=!!c&&e[c].value,x=!!d&&e[d].value;h.has(a)||(p.nodes.push({key:a,label:f,value:y}),h.set(a,u),u++),h.has(l)||(p.nodes.push({key:l,label:g,value:x}),h.set(l,u),u++),p.links.push({source:h.get(a),target:h.get(l)})}return l(p),p},r.tree=function(e,a={}){let r=e.head.lets||e.head.vars||[],n=e.results.bindings,s=a.root||r[0],i=a.parent||r[1],o=a.child||r[2],c=a.value||r[3]||"value",d=new Map,p=new Map,h=!0,u=h;for(let t=0;t<n.length;t++){const e=n[t];if(h=e[i].value,u=e[o].value,h!==u){let t;d.has(h)?(t=d.get(h),t.push(u)):t=[u],d.set(h,t),e[c]&&p.set(u,e[c].value)}}let f=e=>{let a=d.get(e);if(l("Traversing",e,a),!a)return{name:e,value:p.get(e)||1,children:[]};let r=a.map(t=>f(t)),n=t.sum(r,t=>t.value);return{children:r,name:e,value:t.sum([n,p.get(e)])}},g=n[0][s].value;l(g);let y=f(g);return l(y),y},r.htmltable=function(t,e={}){let a=t.head.lets||t.head.vars||[],n=t.results.bindings,s=e.columns||a,i=e.headers||s,o=e.selector||null,c=void 0!==e.limit?e.limit:n.length,d=void 0!==e.offset?e.offset:0;n=n.slice(d,d+c);let p=r.select(o,"htmltable").append("table").attr("class","table table-bordered");l("Table"),l(p);let h=p.append("thead"),u=p.append("tbody");h.append("tr").selectAll("th").data(i).enter().append("th").text(t=>t);let f=u.selectAll("tr").data(n).enter().append("tr").selectAll("td").data(t=>s.map(e=>t[e]?t[e].value:"")).enter().append("td").text(t=>t);l("Table cells"),l(f),p.style({margin:"10px"}),p.selectAll("th").style({background:"#eeeeee","text-transform":"capitalize"})},r.htmlhash=function(t,e={}){let a=t.head.lets||t.head.vars||[],l=t.results.bindings[0],n=e.selector||null,s=r.select(n,"htmlhash").append("table").attr("class","table table-bordered"),i=s.append("tbody").selectAll("tr").data(()=>a.map(t=>({head:t,data:l[t]?l[t].value:""}))).enter().append("tr");i.append("th").text(t=>t.head),i.append("td").text(t=>t.data),s.style({margin:"10px"}),s.selectAll("th").style({background:"#eeeeee","text-transform":"capitalize"})},r.barchart=function(e,a={}){let l=e.head.lets||e.head.vars||[],n=e.results.bindings,s=a.label_x||l[0],i=a.label_y||l[1],o=a.let_x||l[0],c=a.let_y||l[1],d=a.width||750,p=a.height||300,h=a.margin||80,u=a.selector||null,f=t.scale.ordinal().rangeRoundBands([0,d-h],.1),g=t.scale.linear().range([p-h,0]),y=t.svg.axis().scale(f).orient("bottom"),x=t.svg.axis().scale(g).orient("left");f.domain(n.map(t=>t[o].value)),g.domain(t.extent(n,t=>parseInt(t[c].value)));let m=r.select(u,"barchart").append("svg").attr("width",d).attr("height",p),v=m.append("g").attr("class","axis x").attr("transform","translate("+h+","+(p-h)+")").call(y),b=m.append("g").attr("class","axis y").attr("transform","translate("+h+",0)").call(x),k=m.selectAll(".bar").data(n).enter().append("rect").attr("transform","translate("+h+",0)").attr("class","bar").attr("x",t=>f(t[o].value)).attr("width",f.rangeBand()).attr("y",t=>g(t[c].value)).attr("height",t=>p-g(parseInt(t[c].value))-h);v.selectAll("text").attr("dy",".35em").attr("x",10).attr("y",0).attr("transform","rotate(90)").style("text-anchor","start"),v.append("text").attr("class","label").text(s).style("text-anchor","middle").attr("transform","translate("+(d-h)/2+","+(h-5)+")"),b.append("text").attr("class","label").text(i).style("text-anchor","middle").attr("transform","rotate(-90)").attr("x",0-p/2).attr("y",0-(h-20)),k.attr({fill:"steelblue"}),m.selectAll(".axis").attr({stroke:"black",fill:"none","shape-rendering":"crispEdges"}),m.selectAll("text").attr({stroke:"none",fill:"black","font-size":"8pt","font-family":"sans-serif"})},r.piechart=function(e,a={}){let l=e.head.lets||e.head.vars||[],n=e.results.bindings,s=a.label||l[0],i=a.size||l[1],o=a.width||700,c=a.height||700,d=a.margin||10,p=a.selector||null,h=a.hole||100,u=Math.min(o,c)/2-d,f=Math.max(Math.min(u-50,h),0),g=t.scale.category20(),y=t.svg.arc().outerRadius(u).innerRadius(f),x=t.layout.pie().value(t=>t[i].value),m=r.select(p,"piechart").append("svg").attr("width",o).attr("height",c).append("g").attr("transform","translate("+o/2+","+c/2+")"),v=m.selectAll(".arc").data(x(n)).enter().append("g").attr("class","arc"),b=v.append("path").attr("d",y).attr("fill",(t,e)=>g(e));v.append("text").attr("class","label").attr("transform",t=>`translate(${y.centroid(t)})`).attr("dy",".35em").attr("text-anchor","middle").text(t=>t.data[s].value);b.attr({stroke:"#ffffff"}),m.selectAll("text").attr({stroke:"none",fill:"black","font-size":"20px","font-family":"sans-serif"})},r.scatterplot=function(e,a={}){let l=e.head.lets||e.head.vars||[],n=e.results.bindings,s=a.label_x||l[0]||"x",i=a.label_y||l[1]||"y",o=a.label_r||l[2]||"r",c=a.let_x||l[0],d=a.let_y||l[1],p=a.let_r||l[2]||5,h=a.min_r||1,u=a.max_r||20,f=a.width||850,g=a.height||300,y=a.margin_x||80,x=a.margin_y||40,m=a.selector||null,v=t.extent(n,t=>parseInt(t[c].value)),b=t.extent(n,t=>parseInt(t[d].value)),k=t.extent(n,t=>parseInt(t[p]?t[p].value:p)),w=t.scale.linear().range([y,f-y]).domain(v),A=t.scale.linear().range([g-x,x]).domain(b),M=t.scale.linear().range([h,u]).domain(k),_=t.svg.axis().scale(w),j=t.svg.axis().scale(A).orient("left"),z=r.select(m,"scatterplot").append("svg").attr("width",f).attr("height",g),$=z.selectAll("circle").data(n).enter().append("circle").attr("class","node").attr("cx",t=>w(t[c].value)).attr("cy",t=>A(t[d].value)).attr("r",t=>M(t[p]?t[p].value:p)).attr("opacity",.5).append("title").text(t=>t[o]?t[o].value:o),I=z.append("g").attr("class","x axis").attr("transform","translate(0,"+(g-x)+")").call(_),P=z.append("g").attr("class","y axis").attr("transform","translate("+y+",0)").call(j);I.append("text").attr("class","label").text(s).style("text-anchor","middle").attr("transform","translate("+(f-y)/2+","+(x-5)+")"),P.append("text").attr("class","label").text(i).style("text-anchor","middle").attr("transform","rotate(-90)").attr("x",0-g/2).attr("y",0-(y-20)),I.attr({stroke:"black",fill:"none"}),P.attr({stroke:"black",fill:"none"}),$.attr({stroke:"gray","stroke-width":"1px",fill:"lightblue",opacity:.5}),z.selectAll("text").attr({stroke:"none",fill:"black","font-size":"8pt","font-family":"sans-serif"})},r.forcegraph=function(e,a={}){let l=e.head&&e.results?r.graph(e,a):e,n=a.radius||(t=>t.value?h(t.value):1+t.label.length),s=a.charge||-500,i=a.distance||50,o=a.width||1e3,c=a.height||750,d=a.label||!1,p=a.selector||null,h=t.scale.linear().domain(t.extent(l.nodes,t=>parseFloat(t.value))).range([1,20]),u=r.select(p,"forcegraph").append("svg").attr("width",o).attr("height",c),f=u.selectAll(".link").data(l.links).enter().append("line").attr("class","link"),g=u.selectAll(".node").data(l.nodes).enter().append("g"),y=g.append("circle").attr("class","node").attr("r",n),x=g.append("text").text(t=>t[d||"label"]).attr("class","node"),m=t.layout.force().charge(s).linkDistance(i).size([o,c]).nodes(l.nodes).links(l.links).start();m.on("tick",()=>{f.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),x.attr("x",t=>t.x).attr("y",t=>t.y),y.attr("cx",t=>t.x).attr("cy",t=>t.y)}),g.call(m.drag),f.attr({stroke:"#999999"}),y.attr({stroke:"black","stroke-width":"1px",fill:"lightblue",opacity:1}),x.attr({"font-size":"8px","font-family":"sans-serif"})},r.sankey=function(e,a={}){let l=e.head&&e.results?r.graph(e,a):e,n=a.width||750,s=a.height||1200,i=a.margin||10,o=a.selector||null,c=l.nodes,d=l.links;for(let t=0;t<d.length;t++)d[t].value=2;let p=t.sankey().size([n,s]).nodeWidth(15).nodePadding(10).nodes(c).links(d).layout(32),h=p.link(),u=t.scale.category20(),f=r.select(o,"sankey").append("svg").attr("width",n+2*i).attr("height",s+2*i).append("g").attr("transform",`translate(${i},${i})`),g=f.selectAll(".link").data(d).enter().append("path").attr("class","link").attr("d",h).attr("stroke-width",t=>Math.max(1,t.dy)).sort((t,e)=>e.dy-t.dy),y=f.selectAll(".node").data(c).enter().append("g").attr("class","node").attr("transform",t=>`translate(${t.x},${t.y})`).call(t.behavior.drag().origin(t=>t).on("dragstart",(function(){this.parentNode.appendChild(this)})).on("drag",(function(e){t.select(this).attr("transform",`translate(${e.x},${e.y=Math.max(0,Math.min(s-e.dy,t.event.y))})`),p.relayout(),g.attr("d",h)})));y.append("rect").attr("width",t=>t.dx).attr("height",t=>t.dy).attr("fill",t=>u(t.label)).attr("opacity",.5),y.append("text").attr("x",-6).attr("y",t=>t.dy/2).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(t=>t.label).filter(t=>t.x<n/2).attr("x",6+p.nodeWidth()).attr("text-anchor","start"),g.attr({fill:"none",stroke:"grey",opacity:.5})},r.roundtree=function(e,a={}){let l=e.head&&e.results?r.tree(e,a):e,n=a.diameter||800,s=a.angle||360,i=a.depth||200,o=a.radius||5,c=a.selector||null,d=t.layout.tree().size([s,i]).separation((t,e)=>(t.parent===e.parent?1:2)/t.depth),p=d.nodes(l),h=d.links(p),u=t.svg.diagonal.radial().projection(t=>[t.y,t.x/180*Math.PI]),f=r.select(c,"roundtree").append("svg").attr("width",n).attr("height",n).append("g").attr("transform",`translate(${n/2},${n/2})`),g=f.selectAll(".link").data(h).enter().append("path").attr("class","link").attr("d",u),y=f.selectAll(".node").data(p).enter().append("g").attr("class","node").attr("transform",t=>`rotate(${t.x-90}) translate(${t.y})`),x=y.append("circle").attr("r",o),m=y.append("text").attr("dy",".35em").attr("text-anchor",t=>t.x<180?"start":"end").attr("transform",t=>t.x<180?"translate(8)":"rotate(180) translate(-8)").text(t=>t.name);g.attr({fill:"none",stroke:"#cccccc","stroke-width":"1.5px"}),x.attr({fill:"#ffffff",stroke:"steelblue","stroke-width":"1.5px",opacity:1}),m.attr({"font-size":"10px","font-family":"sans-serif"})},r.dendrogram=function(e,a={}){let l=e.head&&e.results?r.tree(e,a):e,n=a.width||800,s=a.height||2e3,i=a.margin||350,o=a.radius||5,c=a.selector||null,d=t.layout.cluster().size([s,n-i]),p=t.svg.diagonal().projection(t=>[t.y,t.x]),h=r.select(c,"dendrogram").append("svg").attr("width",n).attr("height",s).append("g").attr("transform","translate(40,0)"),u=d.nodes(l),f=d.links(u),g=h.selectAll(".link").data(f).enter().append("path").attr("class","link").attr("d",p),y=h.selectAll(".node").data(u).enter().append("g").attr("class","node").attr("transform",t=>`translate(${t.y},${t.x})`),x=y.append("circle").attr("r",o),m=y.append("text").attr("dx",t=>t.parent&&t.children?-8:8).attr("dy",5).style("text-anchor",t=>t.parent&&t.children?"end":"start").text(t=>t.name);g.attr({fill:"none",stroke:"#cccccc","stroke-width":"1.5px"}),x.attr({fill:"#ffffff",stroke:"steelblue","stroke-width":"1.5px",opacity:1}),m.attr({"font-size":"10px","font-family":"sans-serif"})},r.sunburst=function(e,a={}){let l=e.head&&e.results?r.tree(e,a):e,n=a.width||1e3,s=a.height||900,i=a.margin||150,o=a.selector||null,c=Math.min(n,s)/2-i,d=t.scale.linear().range([0,2*Math.PI]),p=t.scale.sqrt().range([0,c]),h=t.scale.category20(),u=r.select(o,"sunburst").append("svg").attr("width",n).attr("height",s).append("g").attr("transform",`translate(${n/2},${s/2})`),f=t.svg.arc().startAngle(t=>Math.max(0,Math.min(2*Math.PI,d(t.x)))).endAngle(t=>Math.max(0,Math.min(2*Math.PI,d(t.x+t.dx)))).innerRadius(t=>Math.max(0,p(t.y))).outerRadius(t=>Math.max(0,p(t.y+t.dy))),g=t.layout.partition().value(t=>t.value).nodes(l),y=u.selectAll("path").data(g).enter().append("path").attr("d",f).attr("class","arc").style("fill",t=>h((t.children?t:t.parent).name)).on("click",b),x=u.selectAll("text").data(g).enter().append("text").attr("transform",t=>`rotate(${180*d(t.x+t.dx/2)/Math.PI-90}) translate(${p(t.y)})`).attr("dx",".5em").attr("dy",".35em").text(t=>t.name).on("click",b);y.attr({stroke:"#ffffff","fill-rule":"evenodd"}),x.attr({"font-size":"10px","font-family":"sans-serif"});let m=t=>t.children?Math.max.apply(Math,t.children.map(m)):t.y+t.dy,v=(t,e)=>t===e||!!t.children&&t.children.some(t=>v(t,e));function b(e){y.transition().duration(750).attrTween("d",(e=>{let a=t.interpolate(d.domain(),[e.x,e.x+e.dx]),r=t.interpolate(p.domain(),[e.y,m(e)]),l=t.interpolate(p.range(),[e.y?20:0,c]);return t=>e=>(d.domain(a(e)),p.domain(r(e)).range(l(e)),f(t))})(e)),x.style("visibility",(function(a){return v(e,a)?null:t.select(this).style("visibility")})).transition().duration(750).attrTween("transform",t=>()=>`rotate(${180*d(t.x+t.dx/2)/Math.PI-90}) translate(${p(t.y)})`).each("end",(function(a){t.select(this).style("visibility",v(e,a)?null:"hidden")}))}},r.circlepack=function(e,a={}){let l=e.head&&e.results?r.tree(e,a):e,n=a.width||800,s=a.height||800,i=a.diameter||700,o=a.selector||null,c=n,d=s,p=i,h=t.scale.linear().range([0,p]),u=t.scale.linear().range([0,p]),f=t.layout.pack().size([p,p]).value(t=>t.value),g=l,y=f.nodes(l),x=r.select(o,"circlepack").append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+(c-p)/2+","+(d-p)/2+")");function m(e,a){let r=p/e.r/2;h.domain([e.x-e.r,e.x+e.r]),u.domain([e.y-e.r,e.y+e.r]);let l=x.transition().duration(t.event.altKey?2e3:500);l.selectAll("circle").attr("cx",(function(t){return h(t.x)})).attr("cy",(function(t){return u(t.y)})).attr("r",(function(t){return r*t.r})),l.selectAll("text").attr("x",(function(t){return h(t.x)})).attr("y",(function(t){return u(t.y)})).style("opacity",(function(t){return r*t.r>20?1:0})),t.event.stopPropagation()}x.selectAll("circle").data(y).enter().append("circle").attr("class",(function(t){return t.children?"parent":"child"})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r})).on("click",(function(t){return m(g===t?l:t)})),x.selectAll("text").data(y).enter().append("text").attr("class",(function(t){return t.children?"parent":"child"})).attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).style("opacity",(function(t){return t.r>20?1:0})).text((function(t){return t.name})).attr("text-anchor","start").transition().duration(1e3).attr("transform",(function(t){return"rotate(-30, "+t.x+", "+t.y+")"})),t.select(window).on("click",(function(){m(l)}))},r.treemap=function(e,a={}){let l=e.head&&e.results?r.tree(e,a):e,n=a.width||800,s=a.height||500,i=a.count||!1,o=a.color||t.scale.category20c(),c=a.margin||{top:0,right:0,bottom:0,left:0},d=a.selector||null;n=n-c.left-c.right,s=s-c.top-c.bottom;let p=t.layout.treemap().size([n,s]).sticky(!0).value(i?t=>1:t=>t.value);r.select(d,"treemap").style("position","relative").style("width",n+"px").style("height",s+"px").style("left",c.left+"px").style("top",c.top+"px").datum(l).selectAll(".node").data(p.nodes).enter().append("div").attr("class","node").call((function(){this.style("left",(function(t){return t.x+"px"})).style("top",(function(t){return t.y+"px"})).style("width",(function(t){return Math.max(0,t.dx-1)+"px"})).style("height",(function(t){return Math.max(0,t.dy-1)+"px"}))})).style("background",t=>t.children?o(t.name):null).text(t=>t.children?null:t.name).style({"border-style":"solid","border-width":"1px","border-color":"white","font-size":"10px","font-family":"sans-serif","line-height":"12px",overflow:"hidden",position:"absolute","text-indent":"2px"})},r.treemapzoom=function(e,a={}){let l,n=e.head&&e.results?r.tree(e,a):e,s={width:a.width||800,height:a.height||500,margin:a.margin||{top:25,right:0,bottom:0,left:0},color:a.color||t.scale.category20(),format:a.format||t.format(",d"),selector:a.selector||null},i=s.width-s.margin.left-s.margin.right,o=s.height-s.margin.top-s.margin.bottom,c=s.color,d=s.format,p=t.scale.linear().domain([0,i]).range([0,i]),h=t.scale.linear().domain([0,o]).range([0,o]),u=t.layout.treemap().children((function(t,e){return e?null:t.children})).sort((function(t,e){return t.value-e.value})).ratio(o/i*.5*(1+Math.sqrt(5))).round(!1),f=r.select(s.selector,"treemapzoom").append("svg").attr("width",s.width).attr("height",s.height).style("margin-left",-s.margin.left+"px").style("margin.right",-s.margin.right+"px").append("g").attr("transform","translate("+s.margin.left+","+s.margin.top+")").style("shape-rendering","crispEdges"),g=f.append("g").attr("class","grandparent");g.append("rect").attr("y",-s.margin.top).attr("width",i).attr("height",s.margin.top).attr("fill","#666666"),g.append("text").attr("x",6).attr("y",6-s.margin.top).attr("dy",".75em").attr("stroke","#ffffff").attr("fill","#ffffff");let y=t=>{t.children&&(u.nodes({children:t.children}),t.children.forEach(e=>{e.x=t.x+e.x*t.dx,e.y=t.y+e.y*t.dy,e.dx*=t.dx,e.dy*=t.dy,e.parent=t,y(e)}))};function x(t){t.attr("x",(function(t){return p(t.x)+6})).attr("y",(function(t){return h(t.y)+6}))}function m(t){t.attr("x",(function(t){return p(t.x)})).attr("y",(function(t){return h(t.y)})).attr("width",(function(t){return p(t.x+t.dx)-p(t.x)})).attr("height",(function(t){return h(t.y+t.dy)-h(t.y)})).attr("fill",(function(t){return c(t.name)})),t.attr({stroke:"#ffffff","stroke-width":"1px",opacity:.8})}(t=>{t.x=t.y=0,t.dx=i,t.dy=o,t.depth=0})(n),y(n),function t(e){g.datum(e.parent).on("click",n).select("text").text(function t(e){return e.parent?t(e.parent)+" / "+e.name:e.name}(e));let a=f.insert("g",".grandparent").datum(e).attr("class","depth"),r=a.selectAll("g").data(e.children).enter().append("g");function n(e){if(l||!e)return;l=!0;let r=t(e),n=a.transition().duration(750),s=r.transition().duration(750);p.domain([e.x,e.x+e.dx]),h.domain([e.y,e.y+e.dy]),f.style("shape-rendering",null),f.selectAll(".depth").sort((function(t,e){return t.depth-e.depth})),r.selectAll("text").style("fill-opacity",0),n.selectAll("text").call(x).style("fill-opacity",0),s.selectAll("text").call(x).style("fill-opacity",1),n.selectAll("rect").call(m),s.selectAll("rect").call(m),n.remove().each("end",(function(){f.style("shape-rendering","crispEdges"),l=!1}))}return r.filter((function(t){return t.children})).classed("children",!0).on("click",n),r.selectAll(".child").data((function(t){return t.children||[t]})).enter().append("rect").attr("class","child").call(m),r.append("rect").attr("class","parent").call(m).append("title").text((function(t){return d(t.value)})),r.append("text").attr("dy",".75em").text((function(t){return t.name})).call(x),r}(n)},r.coordmap=function(e,l={}){let n=e.head.lets||e.head.vars||[],s=e.results.bindings,i=l.let_lat||n[0]||"lat",o=l.let_lng||n[1]||"lng",c=l.width||960,d=l.height||480,p=l.radius||5,h=l.color||"#FF3333",u=l.topojson||"world-50m.json",f=l.selector||null,g=t.geo.equirectangular().scale(153).translate([c/2,d/2]).precision(.1),y=t.geo.path().projection(g),x=t.geo.graticule(),m=r.select(f,"coordmap").append("svg").attr("width",c).attr("height",d);m.append("path").datum(x.outline).attr("fill","#a4bac7").attr("d",y),m.append("path").datum(x).attr("fill","none").attr("stroke","#333333").attr("stroke-width",".5px").attr("stroke-opacity",".5").attr("d",y),t.json(u,(t,e)=>{if(t)throw t;m.insert("path",".graticule").datum(a.feature(e,e.objects.land)).attr("fill","#d7c7ad").attr("stroke","#766951").attr("d",y),m.insert("path",".graticule").datum(a.mesh(e,e.objects.countries,(t,e)=>t!==e)).attr("class","boundary").attr("fill","none").attr("stroke","#a5967e").attr("stroke-width",".5px").attr("d",y),m.selectAll(".pin").data(s).enter().append("circle",".pin").attr("fill",h).attr("r",p).attr("stroke","#455346").attr("transform",(function(t){return"translate("+g([t[o].value,t[i].value])+")"}))})},r.namedmap=function(e,n={}){let s=e.head.lets||e.head.vars||[],i=e.results.bindings,o=n.label||s[0]||"label",c=n.value||s[1]||"value",d=n.width||1e3,p=n.height||1e3,h=n.color_max||"red",u=n.color_min||"white",f=n.color_scale||"log",g=n.topojson||"japan.topojson",y=n.mapname||"japan",x=n.keyname||"name_local",m=n.center_lat||34,v=n.center_lng||137,b=n.scale||1e4,k=n.selector||null,w=t.nest().key(t=>t[o].value).rollup(e=>t.sum(e,t=>parseInt(t[c].value))).map(i),A=t.extent(t.map(w).values());l(w);let M=r.select(k,"namedmap").append("svg").attr("width",d).attr("height",p);t.json(g,e=>{let r,l=a.feature(e,e.objects[y]).features,n=t.geo.mercator().center([v,m]).translate([d/2,p/2]).scale(b),s=t.geo.path().projection(n);switch(f){case"log":r=t.scale.log();break;default:r=t.scale.linear()}let i=r.domain(A).range([u,h]);M.selectAll("path").data(l).enter().append("path").attr("d",s).attr("stroke","black").attr("stroke-width",.5).style("fill",(function(t,e){return i(w[t.properties[x]])})),M.selectAll(".place-label").data(l).enter().append("text").attr("font-size","8px").attr("class","place-label").attr("transform",(function(t){let e=t.properties.latitude,a=t.properties.longitude;return"translate("+n([a,e])+")"})).attr("dx","-1.5em").text(t=>t.properties[x])})},r.select=function(e,a){return(e?t.select(e).html(""):t.select("body")).append("div").attr("class","d3sparql "+a)},r.toggle=function(){let e=t.select("#button"),a=t.select("#sparql");"none"===a.style("display")?(a.style("display","inline"),e.attr("class","icon-chevron-up")):(a.style("display","none"),e.attr("class","icon-chevron-down"))},r.frameheight=function(e){t.select(self.frameElement).style("height",e+"px")},r}));
//# sourceMappingURL=d3sparql.amd.js.map
